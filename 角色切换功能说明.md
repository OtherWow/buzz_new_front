# 角色切换功能说明

## 🎯 功能概述

新增了角色切换功能，允许用户在拥有多个角色权限时进行动态切换，无需重新登录即可体验不同角色的权限和功能。

## ✨ 功能特点

### 1. 动态权限切换
- 用户可以在不同角色间切换
- 切换后立即生效，菜单和权限会相应更新
- 页面自动刷新以应用新权限

### 2. 权限控制
- 只有拥有多个角色的用户才能看到切换按钮
- 用户只能切换到被授权的角色
- 后端控制用户的可用角色列表

### 3. 用户友好的界面
- 在右上角用户下拉菜单中添加"切换角色"选项
- 清晰显示当前角色和可切换的角色
- 提供角色描述帮助用户理解

## 🚀 使用方式

### 1. 查看切换按钮
- 登录后点击右上角的用户头像
- 如果用户有多个可用角色，会看到"切换角色"选项

### 2. 切换角色
- 点击"切换角色"
- 查看当前角色和可用角色列表
- 按照提示选择要切换的角色
- 确认后系统会自动刷新应用新权限

## 📋 角色权限配置

### 测试用户的角色权限：

#### admin (系统管理员)
- **可切换角色**: 所有角色（系统管理员、操作员、普通用户、财务专员）
- **说明**: 管理员可以体验所有角色的功能

#### operator (操作员)  
- **可切换角色**: 操作员、普通用户
- **说明**: 可以在操作员和普通用户间切换

#### user (普通用户)
- **可切换角色**: 仅普通用户
- **说明**: 只有一个角色，不显示切换按钮

## 🎨 新增角色：财务专员

为了更好地演示角色切换功能，新增了"财务专员"角色：

### 财务专员权限
- ✅ 交易管理（读取、创建、更新）
- ✅ 用户管理（仅读取）
- ❌ 角色管理
- ❌ 权限管理  
- ❌ 系统设置

### 使用场景
- 专门负责财务和交易相关操作
- 可以查看用户信息但不能修改
- 权限介于操作员和普通用户之间

## 🔧 技术实现

### 1. 后端API接口
```typescript
// 获取可切换角色列表
GET /auth/available-roles

// 切换角色
POST /auth/switch-role
{
  "role_id": 2
}
```

### 2. 前端状态管理
```typescript
// 角色切换
const switchRole = async (roleId: number) => {
  const response = await authApi.switchRole(roleId)
  // 更新用户状态
  updateUser(response.data)
  // 刷新页面应用新权限
  window.location.reload()
}
```

### 3. 权限验证
- 切换前验证用户是否有权限切换到目标角色
- 切换后立即应用新的权限配置
- 菜单和按钮根据新权限动态显示/隐藏

## 🧪 测试步骤

### 1. 测试管理员角色切换
1. 使用 `admin/admin123` 登录
2. 点击右上角头像 → 切换角色
3. 可以看到所有4个角色选项
4. 选择"操作员"切换
5. 观察菜单变化（权限管理等消失）

### 2. 测试操作员角色切换
1. 切换到操作员角色后
2. 再次点击切换角色
3. 只能看到"操作员"和"普通用户"选项
4. 切换到"普通用户"
5. 观察权限进一步受限

### 3. 测试财务专员
1. 切换到"财务专员"角色
2. 可以看到交易管理和用户管理
3. 但没有角色管理、权限管理、系统设置

## 📱 用户体验优化

### 1. 视觉反馈
- 当前角色用特殊颜色和标记显示
- 切换过程有加载提示
- 成功切换后有确认消息

### 2. 操作引导
- 清晰的说明文字
- 角色描述帮助用户理解
- 确认对话框防止误操作

### 3. 性能优化
- 角色列表缓存，避免重复请求
- 切换后智能刷新，快速生效

## 🔮 扩展可能

### 1. 角色有效期
- 可以设置角色的临时使用期限
- 到期自动切换回默认角色

### 2. 角色历史
- 记录用户的角色切换历史
- 提供最近使用的角色快速切换

### 3. 条件切换
- 基于时间、地点等条件限制角色切换
- 某些敏感操作需要特定角色确认

这个角色切换功能大大增强了系统的灵活性，让用户可以根据需要动态调整权限，特别适合需要承担多重职责的用户！ 